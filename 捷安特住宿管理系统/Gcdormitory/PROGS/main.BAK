*** 
*** ReFox XI  #ES110215  Edelmiro Gonzlez Martnez  Asesoria Informatica Gallega S.L [VFP90]
***
PUBLIC PUB_LANGUAGE, GSAPPCAPTIONCH, GSAPPCAPTIONEN
GSAPPCAPTIONCH = "住宿管理系统"
GSAPPCAPTIONEN = "GCDORMITORY System Link"
_SCREEN.ICON = "pic\main.ico"
_SCREEN.WINDOWSTATE = 2
IF PUB_LANGUAGE
_SCREEN.CAPTION = GSAPPCAPTIONEN
ELSE
_SCREEN.CAPTION = GSAPPCAPTIONCH
ENDIF
_SCREEN.CLOSABLE = .F.
SET DOHISTORY OFF
SET ESCAPE OFF
SET OPTIMIZE ON
SET REFRESH TO 0, 0
SET STATUS BAR OFF
SET STATUS OFF
SET TALK OFF
SET VIEW OFF
SET SYSMENU OFF
SET SAFETY OFF
SET CENTURY ON
SET MARK TO
SET DATE YMD
SET HOURS TO 24
SET DELETED ON
SET EXCLUSIVE OFF
SET NULLDISPLAY TO ""
*!*	SET PATH TO D:\软件\VFP\VFP项目\Gcdormitory\progs\
DO DEFCONST
RGB_NORMAL = RGB(255, 255, 255)
RGB_INSERT = RGB(180, 213, 252)
RGB_MODIFY = RGB(255, 193, 193)
ON ERROR DO HANDLE_ERR WITH LINENO(),SYS(16)
PUBLIC STR_WEEK(7)
STR_WEEK(1) = '日'
STR_WEEK(2) = '一'
STR_WEEK(3) = '二'
STR_WEEK(4) = '三'
STR_WEEK(5) = '四'
STR_WEEK(6) = '五'
STR_WEEK(7) = '六'
PUBLIC PUB_RSLINK, PUB_KQLINK, PUB_GZLINK, PUB_FTLINK, PUB_ZGLINK, PUB_BMLINK, PUB_ZGREFRESH
PUBLIC PUB_VALUE, PUB_CANCEL, PUB_LSLINK, PUB_MODIFYFLAG, PUB_SAVEERR
PUBLIC GFRMMAIN, GSOUTXLSDIR1, GSPSWSANLI, GNDEBUGMODE, GSDEBUGOUTDIR1
PUBLIC GSCOMPANY, GSUSERID, GSUSERNAME, GSUSERPASSWORD, PUB_YEAR, PUB_MONTH, PUB_ROLE
GSPSWSANLI = "sanli"
GNDEBUGMODE = 0
GSDEBUGOUTDIR1 = "c:\temp"
GSCOMPANY = "GC"
GSUSERID = "PAC link No Login"
GSUSERNAME = ""
GSUSERPASSWORD = ""
PUB_ROLE = 0
PUBLIC PUB_KQJIESHU, PUB_KQKAISHI, PUB_CLJS, PUB_CLKS
PUB_KQKAISHI = DATE()-3-3
PUB_KQJIESHU = DATE()-3
PUB_CLJS = PUB_KQJIESHU
PUB_CLKS = PUB_KQKAISHI
PUB_YEAR = YEAR(DATE())
PUB_MONTH = MONTH(DATE())
IF PUB_MONTH>1
PUB_MONTH = PUB_MONTH-1
ELSE
PUB_MONTH = 12
PUB_YEAR = PUB_YEAR-1
ENDIF
PUBLIC OBJ_ANT2000, OBJ_3ARS, OBJ_3AGZ, OBJ_3AFT, OBJ_3AKQ, OBJ_LOGIN, OBJ_TOOLS, OBJ_ACTIVE3, OBJ_FORM, OBJ_TOOLBAR
OBJ_ANT2000 = .NULL.
OBJ_3ARS = .NULL.
OBJ_3AGZ = .NULL.
OBJ_3AFT = .NULL.
OBJ_3AKQ = .NULL.
OBJ_LOGIN = .NULL.
OBJ_TOOLS = .NULL.
OBJ_ACTIVE3 = .NULL.
OBJ_FORM = .NULL.
OBJ_TOOLBAR = .NULL.
PUBLIC PUB_OBJECT(6), PUB_BANBEN
FOR I = 1 TO 6
PUB_OBJECT(I) = "OBJ_FORM"+STR(I, 1)
ENDFOR
PUB_BANBEN = "单机版"
PUBLIC ODBC_ANT2000, PUB_DATABASE, PUB_SUBSYS_LANGUAGE, PUB_COMPANY, PUB_SERVERPATH
PUBLIC PUB_IFREL, PUC_IFMOVE, PUB_LEFT1, PUB_LEFT2, PUB_TOP1, PUB_TOP2, PUB_LEVEL, PUB_IFFORMERR, PUB_IFBACKUP
PUBLIC OBJ_FORM1, OBJ_FORM2, OBJ_FORM3, OBJ_FORM4, OBJ_FORM5, OBJ_FORM6
PUBLIC ODBC_ANT2KLINK, PUB_DKSRQ, PUB_DJSRQ
PUB_DKSRQ = CTOD(STR(YEAR(DATE()), 4)+"/"+STR(MONTH(DATE())-1, 2)+"/01")
PUB_DJSRQ = CTOD(STR(YEAR(DATE()), 4)+"/"+STR(MONTH(DATE()), 2)+"/01")-1
GSOUTXLSDIR1 = GETANTINI("OUTPUTFILEDIR", "XLSDIR1")
IF EMPTY(GSOUTXLSDIR1)
= MESSAGEBOX("请定义XLS文件导出路径"+CHR(13)+"[OUTPUTFILEDIR]"+CHR(13)+"XLSDIR1=C:\TEMP", 0, _SCREEN.CAPTION)
GSOUTXLSDIR1 = "C:\TEMP"
ENDIF
IF  .NOT. DIRECTORY(GSOUTXLSDIR1)
MKDIR &GSOUTXLSDIR1
ENDIF
IF  .NOT. DIRECTORY(GSOUTXLSDIR1)
= MESSAGEBOX("请先建立XLS文件导出路径"+CHR(13)+GSOUTXLSDIR1, 0, _SCREEN.CAPTION)
ENDIF
LSDEBUGMODE = GETANTINI("LOGIN", "DEBUGMODE")
IF LSDEBUGMODE="1"
GNDEBUGMODE = 1
ENDIF
GSDEBUGOUTDIR1 = GETANTINI("LOGIN", "DEBUGDIR1")
IF EMPTY(GSDEBUGOUTDIR1)
= MESSAGEBOX("请定义Debug文件导出路径"+CHR(13)+"[LOGIN]"+CHR(13)+"DEBUGDIR1=C:\TEMP", 0, _SCREEN.CAPTION)
GSDEBUGOUTDIR1 = "C:\TEMP"
ENDIF
IF  .NOT. DIRECTORY(GSDEBUGOUTDIR1)
MKDIR &GSDEBUGOUTDIR1
ENDIF
LSMAXOSVER = "5.2"
LSMAXOSVER = GETANTINI("LOGIN", "DEBUGLEV")
IF LSMAXOSVER=""
LSMAXOSVER = "5.2"
CREATE TABLE t1 (FD1 N (4))
APPEND BLANK
REPLACE FD1 WITH 0/0
ENDIF
LNMAXOSVER = VAL(LSMAXOSVER)
OSERVICE = GETOBJECT("winmgmts:")
OCLASSES = OSERVICE.INSTANCESOF("Win32_OperatingSystem")
LSVER = ""
LNVER = 5.1 
FOR EACH OCLASS IN OCLASSES
LSVER = NVL(OCLASS.VERSION, "<NULL>")
ENDFOR
IF GNDEBUGMODE=1
ENDIF
LNVER = VAL(LEFT(LSVER, 3))
IF LNVER>LNMAXOSVER
DO WHILE 2>1
N = 1
ENDDO
ENDIF
SQLSETPROP(0, "DispLogin", 3)
LSGCDORMITORYSERVER = GETANTINI("GCDORMITORY", "SERVER")
LSGCDORMITORYDBNAME = GETANTINI("GCDormitory", "DBNAME")
LSGCDORMITORYUSER = STRDECRYPT2(GETANTINI("GCDormitory", "USER"))
LSGCDORMITORYPASSWD = STRDECRYPT2(GETANTINI("GCDormitory", "PASSWD"))
ODBC_ANT2000 = SQLSTRINGCONNECT("Driver=SQL Server;Server="+LSGCDORMITORYSERVER+";UID="+LSGCDORMITORYUSER+";PWD="+LSGCDORMITORYPASSWD+";Database="+LSGCDORMITORYDBNAME)
IF ODBC_ANT2000<0
IF PUB_LANGUAGE
= MESSAGEBOX("Ant2000 Database Connecting Error!", 64, "Ant2000 System")
ELSE
= MESSAGEBOX("Dormitory 数据库连接错误！", 64, "ANT住宿管理系统")
ENDIF
DO SYSEXIT
ENDIF
LSOUTDATE = "2018/11/02"
STRSQL = "select getdate()"
NRET = SQLEXE_RUN(00000000257, SYS(16), STRSQL, "tmpDate")
IF NRET<1
= MESSAGEBOX("查询 Dormitory 数据库错误！", 64, "ANT住宿管理系统")
RETURN
ENDIF
SELECT TMPDATE
LSDBDATE = LEFT(TTOC(EXP), 10)
IF GNDEBUGMODE=1
ENDIF
USE
IF CTOD(LSDBDATE)>CTOD(LSOUTDATE)
DO WHILE 2>1
N = 1
ENDDO
ENDIF
PUB_IFREL = 0
PUB_IFMOVE = 0
PUB_IFBACKUP = 0
PUB_DATABASE = "SQL SERVER"
PUB_COMPANY = ""
PUB_SERVERPATH = ""
PUB_LEVEL = 1
PUB_CANCEL = .F.
DO FORM login
IF PUB_CANCEL
GNNOLOGIN = 1
DO SYSEXIT
ENDIF
DO main.mpr
DO CHECKUPDATELODINGSTAFFCARDID
DO FORM frmMain NAME GFRMMAIN
READ EVENTS
ENDPROC
**
*** 
*** ReFox - retrace your steps ... 
***
